<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Amendment to Application — Web Filler (LF1042)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!-- pdf-lib for filling & flattening -->
<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<!-- pdfjs-dist for rendering original PDF to canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<style>
body{font-family:sans-serif;margin:0;padding:0;background:#f4f4f9}
.container{max-width:900px;margin:20px auto;background:#fff;padding:20px;box-shadow:0 0 10px rgba(0,0,0,0.1)}
h1{text-align:center;font-size:20px}
.section{margin-bottom:20px}
label{display:block;margin-top:10px;font-weight:bold}
input,select,textarea{width:100%;padding:8px;margin-top:5px;border:1px solid #ccc;border-radius:4px}
button{margin-top:15px;padding:10px 15px;background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer}
button:hover{background:#0056b3}
.preview{margin-top:20px;text-align:center}
canvas{border:1px solid #ccc;max-width:100%}
.add-btn{background:#28a745}
.add-btn:hover{background:#1e7e34}

/* --- Signature related CSS (disabled) ---
.sig-preview{border:1px dashed #999;padding:10px;text-align:center;cursor:pointer;margin-top:10px}
.sig-preview img{max-width:100%;max-height:100px}
.sig-preview span{color:#666}
.sig-modal{display:none;position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center}
.sig-modal .box{background:#fff;padding:20px;border-radius:4px;text-align:center}
#sigCanvas{border:1px solid #ccc}
.sig-actions{margin-top:10px}
.sig-actions button{margin:0 5px}
--- End Signature related CSS --- */
</style>
</head>
<body>
<div class="container">
  <h1>Amendment to Application (LF1042)</h1>
  <form id="mainForm">
    <div class="section">
      <h3>Policy Owner Details</h3>
      <label>Policy Owner’s Name</label>
      <input type="text" id="OwnerName" />
      <label>NRIC/Passport No</label>
      <input type="text" id="OwnerID" />
    </div>
    <div class="section">
      <h3>Amendment Request</h3>
      <label>Details of Amendment</label>
      <textarea id="AmendDetails"></textarea>
    </div>
    <!-- --- Signature section disabled ---
    <div class="section">
      <h3>Owner Signature</h3>
      <div id="OwnerSigPreview" class="sig-preview"><span>Tap to Sign</span></div>
    </div>
    <div class="section">
      <h3>Witness Signature</h3>
      <div id="WitnessSigPreview" class="sig-preview"><span>Tap to Sign</span></div>
    </div>
    --- End Signature section disabled --- -->
    <div class="section">
      <h3>Submit</h3>
      <button type="button" id="genPdf">Generate PDF</button>
      <button type="button" id="resetForm">Reset</button>
    </div>
  </form>
  <div class="preview">
    <canvas id="pdfCanvas"></canvas>
  </div>
</div>

<!-- --- Signature modal disabled ---
<div id="sigModal" class="sig-modal">
  <div class="box">
    <p>Please sign below</p>
    <canvas id="sigCanvas" width="300" height="150"></canvas>
    <div class="sig-actions">
      <button id="sigClear">Clear</button>
      <button id="sigSave">Save</button>
      <button id="sigCancel">Cancel</button>
    </div>
  </div>
</div>
--- End Signature modal disabled --- -->

<script>
const $=id=>document.getElementById(id);

// const OWNER_SIG={X:370,Y:145,SCALE_PCT:11};
// const WITNESS_SIG={X:70,Y:145,SCALE_PCT:11};
// const SIG_OWNER_KEY='LF1042_SIG_OWNER';
// const SIG_WITNESS_KEY='LF1042_SIG_WITNESS';

function saveForm(){localStorage.setItem('LF1042_FORM',JSON.stringify({
  OwnerName:$('#OwnerName').value,
  OwnerID:$('#OwnerID').value,
  AmendDetails:$('#AmendDetails').value
}))}
function loadForm(){const d=localStorage.getItem('LF1042_FORM');if(d){const o=JSON.parse(d);$('#OwnerName').value=o.OwnerName||'';$('#OwnerID').value=o.OwnerID||'';$('#AmendDetails').value=o.AmendDetails||''}
/* const owner=localStorage.getItem(SIG_OWNER_KEY);if(owner)setSigPreview('owner',owner,false);
const witness=localStorage.getItem(SIG_WITNESS_KEY);if(witness)setSigPreview('witness',witness,false); */ }

['OwnerName','OwnerID','AmendDetails'].forEach(id=>{ $(id).addEventListener('input',saveForm); });

// --- Signature logic disabled ---
/*
let currentSigTarget=null;
function setSigPreview(target,dataUrl,store=true){const el=target==='owner'?$('#OwnerSigPreview'):$('#WitnessSigPreview');el.innerHTML='<img src="'+dataUrl+'" />';if(store){localStorage.setItem(target==='owner'?SIG_OWNER_KEY:SIG_WITNESS_KEY,dataUrl)}}
function openSigModal(target){currentSigTarget=target;$('#sigModal').style.display='flex';clearSigCanvas();}
function closeSigModal(){$('#sigModal').style.display='none'}
const sigCanvas=$('#sigCanvas');const sigCtx=sigCanvas.getContext('2d');let drawing=false;
sigCanvas.addEventListener('mousedown',e=>{drawing=true;sigCtx.moveTo(e.offsetX,e.offsetY)});
sigCanvas.addEventListener('mousemove',e=>{if(drawing){sigCtx.lineTo(e.offsetX,e.offsetY);sigCtx.stroke()}});
sigCanvas.addEventListener('mouseup',()=>{drawing=false});
function clearSigCanvas(){sigCtx.clearRect(0,0,sigCanvas.width,sigCanvas.height)}
$('#sigClear').onclick=clearSigCanvas;
$('#sigSave').onclick=function(){const dataUrl=sigCanvas.toDataURL();setSigPreview(currentSigTarget,dataUrl);closeSigModal();}
$('#sigCancel').onclick=closeSigModal;
$('#OwnerSigPreview').onclick=()=>openSigModal('owner');
$('#WitnessSigPreview').onclick=()=>openSigModal('witness');
*/
// --- End Signature logic disabled ---

async function generatePdf(){
  const url="LF1042_blank.pdf";const pdfBytes=await fetch(url).then(r=>r.arrayBuffer());const pdfDoc=await PDFLib.PDFDocument.load(pdfBytes);const page=pdfDoc.getPages()[0];const font=await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);const draw=(txt,x,y)=>{page.drawText(txt,{x,y,size:10,font})};
  draw($('#OwnerName').value,120,635);
  draw($('#OwnerID').value,120,615);
  draw($('#AmendDetails').value,120,590);
  /* --- Signature embedding disabled ---
  const ownerSigDataUrl=localStorage.getItem(SIG_OWNER_KEY);if(ownerSigDataUrl){const sigBytes=await fetch(ownerSigDataUrl).then(r=>r.arrayBuffer());const sigImg=await pdfDoc.embedPng(sigBytes);page.drawImage(sigImg,{x:OWNER_SIG.X,y:OWNER_SIG.Y,width:sigImg.width*OWNER_SIG.SCALE_PCT/100,height:sigImg.height*OWNER_SIG.SCALE_PCT/100});}
  const witnessSigDataUrl=localStorage.getItem(SIG_WITNESS_KEY);if(witnessSigDataUrl){const sigBytes=await fetch(witnessSigDataUrl).then(r=>r.arrayBuffer());const sigImg=await pdfDoc.embedPng(sigBytes);page.drawImage(sigImg,{x:WITNESS_SIG.X,y:WITNESS_SIG.Y,width:sigImg.width*WITNESS_SIG.SCALE_PCT/100,height:sigImg.height*WITNESS_SIG.SCALE_PCT/100});}
  --- End Signature embedding disabled --- */
  const pdfBytesOut=await pdfDoc.save();const blob=new Blob([pdfBytesOut],{type:'application/pdf'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download='LF1042_filled.pdf';link.click();renderPdfOnCanvas(pdfBytesOut);
}
async function renderPdfOnCanvas(pdfBytes){const pdf=await pdfjsLib.getDocument({data:pdfBytes}).promise;const page=await pdf.getPage(1);const viewport=page.getViewport({scale:1});const canvas=$('#pdfCanvas');canvas.height=viewport.height;canvas.width=viewport.width;await page.render({canvasContext:canvas.getContext('2d'),viewport}).promise}
function resetAll(){localStorage.removeItem('LF1042_FORM');
/* localStorage.removeItem(SIG_OWNER_KEY);localStorage.removeItem(SIG_WITNESS_KEY);$('#OwnerSigPreview').innerHTML='<span>Tap to Sign (Owner)</span>';$('#WitnessSigPreview').innerHTML='<span>Tap to Sign (Witness)</span>'; */
document.getElementById("mainForm").reset();$('#pdfCanvas').getContext('2d').clearRect(0,0,$('#pdfCanvas').width,$('#pdfCanvas').height);}
$('#genPdf').onclick=generatePdf;$('#resetForm').onclick=resetAll;
loadForm();
</script>
</body>
</html>
